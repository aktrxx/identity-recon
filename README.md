# Identity Reconciliation Service

This is a FastAPI backend service that helps reconcile user identities based on email and phone number. It links different contact records that may belong to the same person and returns a consolidated view.

---

## How It Works

- Each contact is stored in a `Contact` table with optional email and phone number.
- If a new request shares an email or phone with an existing contact, it's considered related.
- The oldest related contact becomes **primary**, others become **secondary**.
- The service ensures that all related contacts are linked and returns the full picture of the identity.

---

## API Endpoints

### `POST /identify`

Takes an email and/or phone number and returns the primary contact and all linked data.

**Request:**
```json
{
  "email": "john@example.com",
  "phoneNumber": "9876543210"
}
```

**Response:**
```json
{
  "contact": {
    "primaryContatctId": 1,
    "emails": ["john@example.com", "john.doe@gmail.com"],
    "phoneNumbers": ["9876543210", "9123456780"],
    "secondaryContactIds": [2, 3]
  }
}
```

### `GET /contacts`

Returns a list of all contact records in the database.

---

## Setup (Local)

1. Clone the repo:
```bash
git clone https://github.com/aktrxx/identity-recon.git
cd identity-recon
```

2. Create a virtual environment and install dependencies:
```bash
python -m venv venv
venv\Scripts\activate  # on Windows
pip install -r requirements.txt
```

3. Add your `DATABASE_URL` in a `.env` or as an environment variable.

4. Run the app:
```bash
uvicorn app.main:app --reload
```

---

## Deployment

This app is ready to be deployed on Render[https://identity-recon-4gs7.onrender.com/].


---

## Running Tests

There's a test script in the `tests/` folder. (And YES, Tests was generated by LLM) You can run it after starting the server, Update the BASEURL and run using the following command:

```bash
python tests/test_identity_recon.py
```

---
